import{s as w,r as T,a as S}from"./assets/entry.ssr-31952c23.mjs";import{getNotFound as H}from"./@qwik-city-not-found-paths.js";import{isStaticPath as R}from"./@qwik-city-static-paths.js";import{createReadStream as E}from"fs";import{join as b,basename as C,extname as k}from"path";import{fileURLToPath as _}from"url";import{Http2ServerRequest as j}from"http2";import{TextEncoderStream as D,TextDecoderStream as F,WritableStream as z,ReadableStream as O}from"stream/web";import{fetch as A,Headers as P,Request as U,Response as W,FormData as G}from"undici";import L from"crypto";import{_ as $,a as N,v as I,q as M}from"./assets/@qwik-city-plan-43be2807.mjs";import"@builder.io/partytown/integration";import"react";import"react-dom/server";import"react/jsx-runtime";import"react-webcam";import"drizzle-orm/mysql-core";import"drizzle-orm/mysql2";import"mysql2/promise";import"zod";import"@auth/core";import"@auth/core/providers/discord";import"@auth/drizzle-adapter";function y(e,t){var r;return((r=t?.getOrigin)==null?void 0:r.call(t,e))??t?.origin??process.env.ORIGIN??q(e)}function q(e){const{PROTOCOL_HEADER:t,HOST_HEADER:r}=process.env,d=e.headers,g=t&&d[t]||(e.socket.encrypted||e.connection.encrypted?"https":"http"),f=r??(e instanceof j?":authority":"host"),u=d[f];return`${g}://${u}`}function x(e,t){return Q(e.originalUrl||e.url||"/",t)}var B=/\/\/|\\\\/g;function Q(e,t){return new URL(e.replace(B,"/"),t)}async function X(e,t,r,d,g){const f=new Headers,u=t.headers;for(const o in u){const a=u[o];if(typeof a=="string")f.set(o,a);else if(Array.isArray(a))for(const c of a)f.append(o,c)}const n=async function*(){for await(const o of t)yield o},s=t.method==="HEAD"||t.method==="GET"?void 0:n(),m=new AbortController,i={method:t.method,headers:f,body:s,signal:m.signal,duplex:"half"};return r.on("close",()=>{m.abort()}),{mode:d,url:e,request:new Request(e.href,i),env:{get(o){return process.env[o]}},getWritableStream:(o,a,c)=>{r.statusCode=o,a.forEach((v,p)=>r.setHeader(p,v));const h=c.headers();return h.length>0&&r.setHeader("Set-Cookie",h),new WritableStream({write(v){r.write(v,p=>{p&&console.error(p)})},close(){r.end()}})},getClientConn:()=>g?g(t):{ip:t.socket.remoteAddress},platform:{ssr:!0,incomingMessage:t,node:process.versions.node},locale:void 0}}var Y={"3gp":"video/3gpp","3gpp":"video/3gpp",asf:"video/x-ms-asf",asx:"video/x-ms-asf",avi:"video/x-msvideo",avif:"image/avif",bmp:"image/x-ms-bmp",css:"text/css",flv:"video/x-flv",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",jng:"image/x-jng",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",kar:"audio/midi",m4a:"audio/x-m4a",m4v:"video/x-m4v",mid:"audio/midi",midi:"audio/midi",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ogg:"audio/ogg",pdf:"application/pdf",png:"image/png",rar:"application/x-rar-compressed",shtml:"text/html",svg:"image/svg+xml",svgz:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",txt:"text/plain",wbmp:"image/vnd.wap.wbmp",webm:"video/webm",webp:"image/webp",wmv:"video/x-ms-wmv",woff:"font/woff",woff2:"font/woff2",xml:"text/xml",zip:"application/zip"};function J(){typeof global<"u"&&typeof globalThis.fetch!="function"&&typeof process<"u"&&process.versions.node&&(globalThis.fetch=A,globalThis.Headers=P,globalThis.Request=U,globalThis.Response=W,globalThis.FormData=G),typeof globalThis.TextEncoderStream>"u"&&(globalThis.TextEncoderStream=D,globalThis.TextDecoderStream=F),typeof globalThis.WritableStream>"u"&&(globalThis.WritableStream=z,globalThis.ReadableStream=O),typeof globalThis.crypto>"u"&&(globalThis.crypto=L.webcrypto)}function K(e){var t;J();const r={_deserializeData:$,_serializeData:N,_verifySerializable:I};e.manifest&&w(e.manifest);const d=((t=e.static)==null?void 0:t.root)??b(_(import.meta.url),"..","..","dist");return{router:async(n,s,m)=>{try{const i=y(n,e),l=await X(x(n,i),n,s,"server",e.getClientConn),o=await T(l,e,r);if(o){const a=await o.completion;if(a)throw a;if(o.requestEv.headersSent)return}m()}catch(i){console.error(i),m(i)}},notFound:async(n,s,m)=>{try{if(!s.headersSent){const i=y(n,e),l=x(n,i),o=H(l.pathname);s.writeHead(404,{"Content-Type":"text/html; charset=utf-8","X-Not-Found":l.pathname}),s.end(o)}}catch(i){console.error(i),m(i)}},staticFile:async(n,s,m)=>{var i;try{const l=y(n,e),o=x(n,l);if(R(n.method||"GET",o)){const a=o.pathname;let c;C(a).includes(".")?c=b(d,a):e.qwikCityPlan.trailingSlash?c=b(d,a+"index.html"):c=b(d,a,"index.html");const h=E(c),v=k(c).replace(/^\./,""),p=Y[v];p&&s.setHeader("Content-Type",p),(i=e.static)!=null&&i.cacheControl&&s.setHeader("Cache-Control",e.static.cacheControl),h.on("error",m),h.pipe(s);return}return m()}catch(l){console.error(l),m(l)}}}}const we=K({render:S,qwikCityPlan:M});export{we as default};
